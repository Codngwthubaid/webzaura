"use client";
import { useState, useEffect } from "react";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from "@/components/ui/card";
import {
  Carousel,
  CarouselContent,
  CarouselItem,
  CarouselNext,
  CarouselPrevious,
} from "@/components/ui/carousel";
import { Star } from "lucide-react";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";

interface ReviewProps {
  name: string;
  userName: string;
  comment: string;
  rating: number;
}

export const TestimonialSection = () => {
  const [reviews, setReviews] = useState<ReviewProps[]>([]);
  const [name, setName] = useState("");
  const [userName, setUserName] = useState("");
  const [comment, setComment] = useState("");
  const [rating, setRating] = useState(5);

  useEffect(() => {
    const storedReviews = localStorage.getItem("reviews");
    if (storedReviews) {
      setReviews(JSON.parse(storedReviews));
    }
  }, []);

  const handleSubmit = () => {
    if (name && userName && comment) {
      const newReview: ReviewProps = { name, userName, comment, rating };
      const updatedReviews = [newReview, ...reviews];
      setReviews(updatedReviews);
      localStorage.setItem("reviews", JSON.stringify(updatedReviews));
      setName("");
      setUserName("");
      setComment("");
      setRating(5);
    }
  };

  return (
    <section id="testimonials" className="container py-24 sm:py-32 px-10">
      <div className="text-center mb-8">
        <h2 className="text-lg text-primary tracking-wider">Testimonials</h2>
        <h2 className="text-3xl md:text-4xl font-bold mb-4">
          Hear What Our Clients Say
        </h2>
      </div>

      {/* Feedback Form */}
      <div className="bg-muted/50 dark:bg-card p-6 rounded-lg mb-10 max-w-xl mx-auto">
        <h3 className="text-2xl font-semibold mb-4 text-center">Share Your Feedback</h3>
        <Input placeholder="Your Name" value={name} onChange={(e) => setName(e.target.value)} className="mb-4" />
        <Input placeholder="Your Profession" value={userName} onChange={(e) => setUserName(e.target.value)} className="mb-4" />
        <Textarea placeholder="Your Feedback" value={comment} onChange={(e) => setComment(e.target.value)} className="mb-4" />
        <div className="flex gap-1 mb-4">
          {[1, 2, 3, 4, 5].map((star) => (
            <Star
              key={star}
              className={`size-5 cursor-pointer ${rating >= star ? "fill-primary text-primary" : "text-gray-400"}`}
              onClick={() => setRating(star)}
            />
          ))}
        </div>
        <Button onClick={handleSubmit} className="w-full">Submit Feedback</Button>
      </div>

      {/* Testimonials Carousel */}
      {reviews.length > 0 && (
        <Carousel className="relative w-[80%] sm:w-[90%] lg:max-w-screen-xl mx-auto">
          <CarouselContent>
            {reviews.map((review, index) => (
              <CarouselItem key={index} className="md:basis-1/2 lg:basis-1/3">
                <Card className="bg-muted/50 dark:bg-card">
                  <CardContent className="pt-6 pb-0">
                    <div className="flex gap-1 pb-6">
                      {[...Array(5)].map((_, i) => (
                        <Star key={i} className={`size-4 ${i < review.rating ? "fill-primary text-primary" : "text-gray-400"}`} />
                      ))}
                    </div>
                    <p>{review.comment}</p>
                  </CardContent>
                  <CardHeader>
                    <div className="flex flex-row items-center gap-4">
                      <div className="flex flex-col">
                        <CardTitle className="text-lg">{review.name}</CardTitle>
                        <CardDescription>{review.userName}</CardDescription>
                      </div>
                    </div>
                  </CardHeader>
                </Card>
              </CarouselItem>
            ))}
          </CarouselContent>
          <CarouselPrevious />
          <CarouselNext />
        </Carousel>
      )}
    </section>
  );
};
